<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>รายละเอียดการตรวจงาน</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .page-break { page-break-after: always; }
    .signature { display: flex; justify-content: space-between; margin-top: 40px; }
    .signature div { width: 40%; text-align: center; }
    .record-box { border: 1px solid #aaa; padding: 10px; margin: 10px 0; }
  </style>
</head>
<body>
  <header>
    <h1>รายละเอียดการตรวจงาน</h1>
    <p>ผู้ใช้งาน: <span id="displayUser"></span></p>
    <p>โครงการ: <span id="projectName"></span> | แปลง: <span id="plotName"></span></p>
  </header>

  <main id="detailContainer"></main>

  <section class="buttons">
    <button onclick="window.print()">พิมพ์รายงาน</button>
    <button onclick="window.location.href='index.html'">กลับหน้าหลัก</button>
  </section>

  <script src="app.js"></script>
  <script>
    const user = getUser();
    document.getElementById("displayUser").textContent = user;

    const project = localStorage.getItem("selected_project") || "";
    const plot = localStorage.getItem("selected_plot") || "";
    document.getElementById("projectName").textContent = project;
    document.getElementById("plotName").textContent = plot;

    const key = `${project}_${plot}`;
    const records = JSON.parse(localStorage.getItem(key) || "[]");
    const container = document.getElementById("detailContainer");

    let pageCount = 0;
    for (let i = 0; i < records.length; i += 5) {
      const group = records.slice(i, i + 5);
      const page = document.createElement("div");

      group.forEach((r, index) => {
        const box = document.createElement("div");
        box.className = "record-box";
        box.innerHTML = `
          <h3>รายการที่ ${i + index + 1}</h3>
          <p>วันที่: ${r.startDate} - ${r.endDate}</p>
          <p>รายละเอียด: ${r.item}</p>
          <p>สถานะ: ${r.status}</p>
          <div style="display: flex; flex-wrap: wrap;">
            <div style="width: 50%;"><p>ก่อนทำ 1:</p><img src="${r.before1}" width="100%"></div>
            <div style="width: 50%;"><p>ก่อนทำ 2:</p><img src="${r.before2}" width="100%"></div>
            <div style="width: 50%;"><p>หลังทำ 1:</p><img src="${r.after1}" width="100%"></div>
            <div style="width: 50%;"><p>หลังทำ 2:</p><img src="${r.after2}" width="100%"></div>
          </div>
        `;
        page.appendChild(box);
      });

      // ส่วนเซ็นชื่อ
      const sign = document.createElement("div");
      sign.className = "signature";
      sign.innerHTML = `
        <div>ลงชื่อผู้ควบคุมงาน<br/><br/>__________________________</div>
        <div>ลงชื่อผู้จัดการโครงการ<br/><br/>__________________________</div>
      `;
      page.appendChild(sign);

      page.className = "page-break";
      container.appendChild(page);
    }
  </script>
</body>
</html>
