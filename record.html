<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</h1>
  <form id="recordForm">
    <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£: <input id="project" required></label>
    <label>‡πÄ‡∏•‡∏Ç‡πÅ‡∏õ‡∏•‡∏á: <input id="plot" required></label>
    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°: <input type="date" id="startDate" required></label>
    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à: <input type="date" id="endDate"></label>
    <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô: <textarea id="description" required></textarea></label>

    <label>üì∑ ‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥ 1: <input type="file" id="before1" accept="image/*" capture="environment"></label>
    <label>üì∑ ‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥ 2: <input type="file" id="before2" accept="image/*" capture="environment"></label>
    <label>üì∑ ‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥ 1: <input type="file" id="after1" accept="image/*" capture="environment"></label>
    <label>üì∑ ‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥ 2: <input type="file" id="after2" accept="image/*" capture="environment"></label>

    <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:
      <select id="status">
        <option value="‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</option>
        <option value="QC ‡∏ú‡πà‡∏≤‡∏ô">QC ‡∏ú‡πà‡∏≤‡∏ô</option>
        <option value="‡∏•‡∏π‡∏Å‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö">‡∏•‡∏π‡∏Å‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö</option>
      </select>
    </label>
    <button type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </form>
  <button onclick="location.href='index.html'">üîô ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>

  <script>
    const form = document.getElementById('recordForm');
    const user = localStorage.getItem('aeUser') || '-';

    async function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    form.onsubmit = async function(e) {
      e.preventDefault();
      const before1 = form.before1.files[0] ? await toBase64(form.before1.files[0]) : '';
      const before2 = form.before2.files[0] ? await toBase64(form.before2.files[0]) : '';
      const after1 = form.after1.files[0] ? await toBase64(form.after1.files[0]) : '';
      const after2 = form.after2.files[0] ? await toBase64(form.after2.files[0]) : '';

      const record = {
        project: form.project.value.trim(),
        plot: form.plot.value.trim(),
        startDate: form.startDate.value,
        endDate: form.endDate.value,
        description: form.description.value.trim(),
        beforeImage: [before1, before2].filter(x => x).join('|'),
        afterImage: [after1, after2].filter(x => x).join('|'),
        status: form.status.value,
        user
      };

      const response = await fetch("https://script.google.com/macros/s/AKfycbz6TxFLY4L6kX15soOUBd-jRMY5cBB80jZtEDhJkkBq4TRLW6EhdmvxOPizJSo5w3jzHg/exec", {
        method: "POST",
        body: JSON.stringify([record]),
        headers: {
          "Content-Type": "application/json"
        }
      });

      const text = await response.text();
      alert(text);
      form.reset();
    };
  </script>
</body>
</html>