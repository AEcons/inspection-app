<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>บันทึกรายการ</title>
  <style>
    body { font-family: sans-serif; padding: 10px; max-width: 600px; margin: auto; }
    input, select, button, textarea { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; }
    img { max-width: 100%; margin-top: 10px; }
    #message { font-weight: bold; }
  </style>
</head>
<body>
  <h2>บันทึก/แก้ไข รายการ</h2>
  <input list="projectList" id="project" placeholder="โครงการ">
  <datalist id="projectList"></datalist>
  <input list="plotList" id="plot" placeholder="เลขแปลง">
  <datalist id="plotList"></datalist>
  <input type="date" id="startDate">
  <input type="date" id="endDate">
  <textarea id="description" placeholder="รายละเอียดรายการ"></textarea>
  <label>รูปก่อนแก้ไข:</label>
  <input type="file" accept="image/*" onchange="previewImage(this, 'beforeImg')">
  <img id="beforeImg">
  <label>รูปหลังแก้ไข:</label>
  <input type="file" accept="image/*" onchange="previewImage(this, 'afterImg')">
  <img id="afterImg">
  <label>สถานะบ้าน:</label>
  <select id="status">
    <option value="">เลือกสถานะ</option>
    <option value="ระหว่างแก้ไข">ระหว่างแก้ไข</option>
    <option value="QC pass">QC pass</option>
    <option value="ลูกค้ารับมอบ">ลูกค้ารับมอบ</option>
  </select>
  <button onclick="saveEntry()">บันทึกรายการ</button>
  <button onclick="loadEntry()">แสดงข้อมูลเดิม</button>
  <button onclick="window.location.href='index.html'">กลับเมนูหลัก</button>
  <p id="message"></p>
<script>
function previewImage(input, imgId) {
  const reader = new FileReader();
  reader.onload = e => document.getElementById(imgId).src = e.target.result;
  reader.readAsDataURL(input.files[0]);
}
function saveEntry() {
  const p = project.value.trim(), pl = plot.value.trim(), s = startDate.value, d = description.value.trim();
  if (!p || !pl || !s || !d) {
    message.innerText = "กรุณากรอกข้อมูลให้ครบถ้วน"; message.style.color = "red"; return;
  }
  const data = JSON.parse(localStorage.getItem('inspectionData') || '[]');
  data.push({
    project: p, plot: pl, start: s, end: endDate.value, description: d,
    status: status.value, beforeImg: beforeImg.src, afterImg: afterImg.src
  });
  localStorage.setItem('inspectionData', JSON.stringify(data));
  message.innerText = "บันทึกข้อมูลเรียบร้อยแล้ว"; message.style.color = "green";
}
function loadEntry() {
  const data = JSON.parse(localStorage.getItem('inspectionData') || '[]');
  const p = project.value.trim(), pl = plot.value.trim();
  const found = data.find(d => d.project === p && d.plot === pl);
  if (!found) { message.innerText = "ไม่พบข้อมูลเดิม"; message.style.color = "red"; return; }
  startDate.value = found.start; endDate.value = found.end; description.value = found.description;
  status.value = found.status; beforeImg.src = found.beforeImg; afterImg.src = found.afterImg;
  message.innerText = "โหลดข้อมูลเดิมแล้ว"; message.style.color = "green";
}
window.onload = () => {
  const data = JSON.parse(localStorage.getItem('inspectionData') || '[]');
  const ps = [...new Set(data.map(d => d.project))];
  const pls = [...new Set(data.map(d => d.plot))];
  projectList.innerHTML = ps.map(p => `<option value="${p}">`).join('');
  plotList.innerHTML = pls.map(pl => `<option value="${pl}">`).join('');
};
</script>
</body>
</html>
