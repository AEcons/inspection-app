<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ</h2>
  <label for="projectSummary">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£:</label>
  <select id="projectSummary" onchange="renderSummary()"></select>
  <div id="summaryContainer"></div>
  <button onclick="location.href='index.html'">üîô ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>

  <script>
    function renderProjects() {
      const data = JSON.parse(localStorage.getItem('aeRecords') || '[]');
      const projects = [...new Set(data.map(r => r.project))];
      const select = document.getElementById('projectSummary');
      select.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ --</option>' +
        projects.map(p => `<option value="${p}">${p}</option>`).join('');
    }

    function renderSummary() {
      const data = JSON.parse(localStorage.getItem('aeRecords') || '[]');
      const project = document.getElementById('projectSummary').value;
      const filtered = data.filter(r => r.project === project);
      const container = document.getElementById('summaryContainer');

      if (!project || filtered.length === 0) {
        container.innerHTML = "<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>";
        return;
      }

      const total = filtered.length;
      const byStatus = {
        '‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç': 0,
        'QC Pass': 0,
        '‡∏•‡∏π‡∏Å‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö': 0
      };
      filtered.forEach(r => {
        if (byStatus.hasOwnProperty(r.status)) {
          byStatus[r.status]++;
        }
      });

      const remaining = total - (byStatus['‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç'] + byStatus['QC Pass'] + byStatus['‡∏•‡∏π‡∏Å‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö']);

      container.innerHTML = `
        <h3>‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£: ${project}</h3>
        <ul>
          <li>üìå ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${total}</li>
          <li>üîß ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ${byStatus['‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç']}</li>
          <li>‚úÖ QC Pass: ${byStatus['QC Pass']}</li>
          <li>üì¶ ‡∏•‡∏π‡∏Å‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö: ${byStatus['‡∏•‡∏π‡∏Å‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö']}</li>
          <li>üïí ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£: ${remaining}</li>
        </ul>
      `;
    }

    window.onload = renderProjects;
  </script>
</body>
</html>