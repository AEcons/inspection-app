<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>เข้าสู่ระบบ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main class="login-container">
    <h1>เข้าสู่ระบบ</h1>

    <label>ชื่อผู้ใช้งานเดิม
      <select id="usernameSelect">
        <option value="">-- เลือกชื่อ --</option>
      </select>
    </label>

    <label>หรือกรอกชื่อใหม่
      <input type="text" id="newUsername" placeholder="ชื่อผู้ใช้งานใหม่">
    </label>

    <button onclick="login()">เข้าสู่ระบบ</button>
    <button onclick="changeUsername()">เปลี่ยนชื่อ</button>
    <button onclick="deleteUser()">ลบบัญชี</button>
  </main>

  <script>
    const USER_KEY = "username";
    const USER_LIST_KEY = "userList";

    function loadUserList() {
      const users = JSON.parse(localStorage.getItem(USER_LIST_KEY)) || [];
      const select = document.getElementById("usernameSelect");
      select.innerHTML = '<option value="">-- เลือกชื่อ --</option>';
      users.forEach(user => {
        const opt = document.createElement("option");
        opt.value = user;
        opt.textContent = user;
        select.appendChild(opt);
      });
    }

    function login() {
      const selected = document.getElementById("usernameSelect").value;
      const newName = document.getElementById("newUsername").value;
      const name = selected || newName;
      if (!name) return alert("กรุณาระบุชื่อ");

      saveUser(name);
      location.href = "index.html";
    }

    function saveUser(name) {
      localStorage.setItem(USER_KEY, name);

      const users = JSON.parse(localStorage.getItem(USER_LIST_KEY)) || [];
      if (!users.includes(name)) {
        users.push(name);
        localStorage.setItem(USER_LIST_KEY, JSON.stringify(users));
      }
    }

    function changeUsername() {
      const newName = prompt("กรอกชื่อใหม่:");
      if (!newName) return;

      const pass = prompt("กรอกรหัสเพื่อเปลี่ยนชื่อ:");
      if (pass !== "211421") return alert("รหัสไม่ถูกต้อง");

      saveUser(newName);
      alert("เปลี่ยนชื่อเรียบร้อย");
      location.reload();
    }

    function deleteUser() {
      const pass = prompt("กรอกรหัสเพื่อยืนยันการลบ:");
      if (pass !== "211421") return alert("รหัสไม่ถูกต้อง");

      const current = localStorage.getItem(USER_KEY);
      localStorage.removeItem(USER_KEY);

      let users = JSON.parse(localStorage.getItem(USER_LIST_KEY)) || [];
      users = users.filter(u => u !== current);
      localStorage.setItem(USER_LIST_KEY, JSON.stringify(users));
      alert("ลบชื่อแล้ว");
      location.reload();
    }

    window.onload = loadUserList;
  </script>
</body>
</html>

