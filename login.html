<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>เข้าสู่ระบบ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>เข้าสู่ระบบ</h2>
  <form onsubmit="loginUser(event)">
    <input id="username" placeholder="ชื่อผู้ใช้งาน" list="userList" required>
    <datalist id="userList"></datalist>
    <button type="submit">เข้าสู่ระบบ</button>
  </form>

  <button onclick="editUsername()">แก้ไขชื่อผู้ใช้งาน</button>
  <button onclick="deleteUsername()">ลบบัญชีผู้ใช้งาน</button>

  <script>
    const USER_KEY = 'aeUserList';
    const CURRENT_USER = 'aeUser';
    const PASSWORD = '211421'; // รหัสลับ

    let userList = JSON.parse(localStorage.getItem(USER_KEY) || '[]');
    const datalist = document.getElementById('userList');

    // แสดงชื่อใน datalist
    function refreshDatalist() {
      datalist.innerHTML = '';
      userList.forEach(name => {
        const opt = document.createElement('option');
        opt.value = name;
        datalist.appendChild(opt);
      });
    }

    refreshDatalist();

    function loginUser(e) {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      if (!username) return alert("กรุณากรอกชื่อผู้ใช้งาน");

      if (!userList.includes(username)) {
        userList.push(username);
        localStorage.setItem(USER_KEY, JSON.stringify(userList));
      }

      localStorage.setItem(CURRENT_USER, username);
      window.location.href = 'index.html';
    }

    function editUsername() {
      const pass = prompt("กรอกรหัสเพื่อแก้ไขชื่อ:");
      if (pass !== PASSWORD) return alert("รหัสไม่ถูกต้อง");

      const oldName = document.getElementById('username').value.trim();
      if (!userList.includes(oldName)) return alert("กรุณาเลือกชื่อที่ต้องการแก้ไข");

      const newName = prompt("กรอกชื่อใหม่:");
      if (!newName) return;

      userList = userList.map(n => n === oldName ? newName : n);
      localStorage.setItem(USER_KEY, JSON.stringify(userList));
      localStorage.setItem(CURRENT_USER, newName);
      refreshDatalist();
      document.getElementById('username').value = newName;
    }

    function deleteUsername() {
      const pass = prompt("กรอกรหัสเพื่อ *ลบ* ผู้ใช้งาน:");
      if (pass !== PASSWORD) return alert("รหัสไม่ถูกต้อง");

      const nameToDelete = document.getElementById('username').value.trim();
      if (!userList.includes(nameToDelete)) return alert("ไม่พบชื่อในระบบ");

      if (!confirm(`คุณต้องการลบ "${nameToDelete}" จริงหรือไม่?`)) return;

      userList = userList.filter(n => n !== nameToDelete);
      localStorage.setItem(USER_KEY, JSON.stringify(userList));
      if (localStorage.getItem(CURRENT_USER) === nameToDelete) {
        localStorage.removeItem(CURRENT_USER);
      }
      document.getElementById('username').value = '';
      refreshDatalist();
      alert(`ลบ "${nameToDelete}" แล้ว`);
    }
  </script>
</body>
</html>
