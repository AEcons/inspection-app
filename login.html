<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>เข้าสู่ระบบ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="login-container">
    <h2>เข้าสู่ระบบ</h2>
    <form onsubmit="loginUser(event)">
      <input id="username" placeholder="ชื่อผู้ใช้งาน" list="userList" required>
      <datalist id="userList"></datalist>
      <button type="submit">เข้าสู่ระบบ</button>
    </form>
    <div class="account-options">
      <button onclick="promptRenameUser()">เปลี่ยนชื่อผู้ใช้งาน</button>
      <button onclick="promptDeleteUser()">ลบบัญชีผู้ใช้งาน</button>
    </div>
  </div>

  <script>
    const storedUsers = JSON.parse(localStorage.getItem('aeUserList') || '[]');
    const datalist = document.getElementById('userList');
    storedUsers.forEach(u => {
      const opt = document.createElement('option');
      opt.value = u;
      datalist.appendChild(opt);
    });

    function loginUser(e) {
      e.preventDefault();
      const user = document.getElementById('username').value.trim();
      if (!user) return alert('กรุณากรอกชื่อผู้ใช้งาน');
      localStorage.setItem('aeUser', user);
      if (!storedUsers.includes(user)) {
        storedUsers.push(user);
        localStorage.setItem('aeUserList', JSON.stringify(storedUsers));
      }
      window.location.href = 'index.html';
    }

    function promptRenameUser() {
      const oldName = document.getElementById('username').value.trim();
      if (!oldName || !storedUsers.includes(oldName)) return alert('กรุณาเลือกชื่อผู้ใช้ที่ต้องการเปลี่ยน');
      const pass = prompt('กรอกรหัสเพื่อเปลี่ยนชื่อ (6 หลัก)');
      if (pass !== '211421') return alert('รหัสไม่ถูกต้อง');
      const newName = prompt('ระบุชื่อใหม่');
      if (newName && newName.trim() && !storedUsers.includes(newName)) {
        const index = storedUsers.indexOf(oldName);
        storedUsers[index] = newName.trim();
        localStorage.setItem('aeUserList', JSON.stringify(storedUsers));
        alert('เปลี่ยนชื่อเรียบร้อย กรุณาเข้าสู่ระบบใหม่');
        window.location.reload();
      } else {
        alert('ชื่อใหม่ไม่ถูกต้องหรือซ้ำ');
      }
    }

    function promptDeleteUser() {
      const user = document.getElementById('username').value.trim();
      if (!user || !storedUsers.includes(user)) return alert('กรุณาเลือกชื่อผู้ใช้ที่ต้องการลบ');
      const confirmPass = prompt('กรอกรหัสเพื่อลบผู้ใช้');
      if (confirmPass !== '211421') return alert('รหัสไม่ถูกต้อง');
      const index = storedUsers.indexOf(user);
      storedUsers.splice(index, 1);
      localStorage.setItem('aeUserList', JSON.stringify(storedUsers));
      alert('ลบชื่อผู้ใช้งานแล้ว');
      window.location.reload();
    }
  </script>
</body>
</html>
